<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE CRIB</title>
    <link rel="stylesheet" href="/css/style.css"> 
    <style>
        /* Basic styles just to make the buttons visible while you test! */
        body {
            font-family: sans-serif;
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 20px;
        }
        .main-buttons a {
            display: block;
            margin: 15px auto;
            padding: 15px 30px;
            text-decoration: none;
            color: #fff;
            background-color: #555;
            border: 2px solid #0f0;
            border-radius: 8px;
            font-size: 1.2em;
            max-width: 300px;
        }
        .main-buttons a:hover {
            background-color: #777;
        }
        .secret-roast {
            font-size: 0.8em;
            color: #ff00ff; /* Zesty color, naturally */
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="user-nav">
        <div id="user-profile" class="hidden">
            <img id="user-pic" src="/STORAGE/photos/user.png" alt="Profile">
        </div>
        <button id="auth-btn">Sign In</button>
    </div>

    <header>
        <h1>THE CRIB</h1>
        <p>Enter the Crib. Defeat the Block. Escape the Grind.</p>
    </header>

    <nav class="main-buttons">
        <a href="play.html" class="button primary">
            <span class="icon">üéÆ</span> The Vault (Play Games)
        </a>

        <a href="request.html" class="button secondary">
            <span class="icon">üìú</span> The Cartographer's Desk (Request)
        </a>

        <a href="about.html" class="button tertiary">
            <span class="icon">üßë‚Äçü§ù‚Äçüßë</span> The Guild Roster (About Us)
        </a>
    </nav>

    <section class="info-area">
        <h2>Crib Status: UNSEALED!</h2>
        <p>Ready to drop the hottest unblocked links.</p>
    </section>
    
    <p class="secret-roast">Connor is still zesty and won't make it past Crib security.</p>


    <footer>
        <p>&copy; The Crib, formally The Game Dungeon | Built by the Green Belt Master. Guild Initials: D, A, J.</p>
    </footer>

  <script type="module">
  // 1. Import the Redirect-specific tools
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDbXozgQ_qo8uS6j7rHH4aUDSsycA2dEeE",
    authDomain: "the-game-dungeon.firebaseapp.com",
    projectId: "the-game-dungeon",
    storageBucket: "the-game-dungeon.firebasestorage.app",
    messagingSenderId: "1097951076505",
    appId: "1:1097951076505:web:8a07e79204d461c233d808",
    measurementId: "G-4SJG95336Y"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const loginBtn = document.getElementById('auth-btn');
  const userPic = document.getElementById('user-pic');

  // 2. Trigger the Redirect when clicked
  loginBtn.addEventListener('click', () => {
    signInWithRedirect(auth, provider);
  });

  // 3. This runs automatically when you get sent back from Google
  getRedirectResult(auth)
    .then((result) => {
      // Check if we just logged in
      const user = result?.user || auth.currentUser;

      if (user) {
        console.log("Welcome back to The Crib, " + user.displayName);
        userPic.src = user.photoURL; // Swap the local PNG for the Google face
        loginBtn.style.display = 'none'; // Hide the button
      }
    }).catch((error) => {
      console.error("Auth error, bro:", error.message);
    });

  // 4. Keep the user logged in if they refresh the page
  auth.onAuthStateChanged((user) => {
    if (user) {
      userPic.src = user.photoURL;
      loginBtn.style.display = 'none';
    }
  });
</script>
</body>
</html>
